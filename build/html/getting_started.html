
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Getting Started &#8212; Seldonian Engine pre-release documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API" href="api.html" />
    <link rel="prev" title="Overview" href="overview.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this heading">¶</a></h1>
<section id="installation">
<span id="id1"></span><h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h2>
<p>To use the Seldonian Engine, first install it using pip:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(.venv)</span> <span class="gp">$ </span>pip install seldonian-engine
</pre></div>
</div>
<p>If you want to visualize the parse tree graphs, a system-wide installation of <a class="reference external" href="https://graphviz.org/download/">Graphviz</a> is required.</p>
</section>
<section id="simple-example">
<span id="id2"></span><h2>Simple example<a class="headerlink" href="#simple-example" title="Permalink to this heading">¶</a></h2>
<p>Consider a simple supervised regression problem with two continous random variables X and Y. Our goal is to predict label Y using the single feature X. To solve this problem we could use univariate linear regression with an objective function of the mean squared error (MSE). We can find the optimal solution to this problem by minimizing the objective function w.r.t. to the weights of the model, <span class="math notranslate nohighlight">\({\theta}\)</span>, which in this case are just the intercept and slope of the line.</p>
<p>Now let’s suppose we want to add the following constraint into the problem: the MSE is less than 2.0, and we want to enforce this with a probability of 0.95. This is now a Seldonian machine learning problem. We now have all of the high level information we need to solve the problem using the engine!</p>
<p>To code this up as a real example using the engine, we need to:</p>
<ul class="simple">
<li><p>Define the data - we’ll need to generate some synthetic data</p></li>
<li><p>Define the metadata - in this case just the column names</p></li>
<li><p>Put data and metadata together into a DataSet object</p></li>
<li><p>Define the behavioral constraint (constraint string and confidence level)</p></li>
<li><p>Make the parse tree from this behavioral constraint</p></li>
<li><p>Define the underlying machine learning model and primary objective</p></li>
<li><p>Define an initial solution function which takes the features and labels as inputs and outputs an initial solution theta vector - in this case we will use the <code class="code docutils literal notranslate"><span class="pre">fit()</span></code> method of the model object.</p></li>
<li><p>Create a spec object containing all of this information and some hyperparameters - we can mostly use the defaults</p></li>
<li><p>Run the Seldonian algorithm using the spec object</p></li>
</ul>
<p>Let’s write out the code to do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">autograd.numpy</span> <span class="k">as</span> <span class="nn">np</span>   <span class="c1"># Thinly-wrapped version of Numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">seldonian.models.model</span> <span class="kn">import</span> <span class="n">LinearRegressionModel</span>
<span class="kn">from</span> <span class="nn">seldonian.dataset</span> <span class="kn">import</span> <span class="n">SupervisedDataSet</span>
<span class="kn">from</span> <span class="nn">seldonian.parse_tree.parse_tree</span> <span class="kn">import</span> <span class="n">ParseTree</span>
<span class="kn">from</span> <span class="nn">seldonian.spec</span> <span class="kn">import</span> <span class="n">SupervisedSpec</span>
<span class="kn">from</span> <span class="nn">seldonian.seldonian_algorithm</span> <span class="kn">import</span> <span class="n">seldonian_algorithm</span>

<span class="k">def</span> <span class="nf">generate_data</span><span class="p">(</span><span class="n">numPoints</span><span class="p">,</span><span class="n">loc_X</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">loc_Y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">sigma_X</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">sigma_Y</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The function we will use to generate</span>
<span class="sd">    synthetic data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sample x from a standard normal distribution</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc_X</span><span class="p">,</span> <span class="n">sigma_X</span><span class="p">,</span> <span class="n">numPoints</span><span class="p">)</span>
    <span class="c1"># Set y to be x, plus noise from a standard normal distribution</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc_Y</span><span class="p">,</span> <span class="n">sigma_Y</span><span class="p">,</span> <span class="n">numPoints</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">numPoints</span><span class="o">=</span><span class="mi">1000</span>

    <span class="c1"># Define the data</span>
    <span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="n">generate_data</span><span class="p">(</span><span class="n">numPoints</span><span class="p">)</span>

    <span class="c1"># Define the metadataa</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feature1&#39;</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>

    <span class="c1"># Make a dataset object</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

    <span class="n">dataset</span> <span class="o">=</span> <span class="n">SupervisedDataSet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
        <span class="n">meta_information</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
        <span class="n">label_column</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span>
        <span class="n">include_intercept_term</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot; include_intercept_term=True</span>
<span class="sd">    adds a column of ones in the</span>
<span class="sd">    feature array for convenience</span>
<span class="sd">    during matrix multiplication.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Define the behavioral constraints</span>
    <span class="n">constraint_strs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mean_Squared_Error - 2.0&#39;</span><span class="p">]</span>
    <span class="n">deltas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">]</span> <span class="c1"># confidence levels</span>

    <span class="c1"># Make the parse tree from this behavioral constraint</span>
    <span class="c1"># Even though we only have one constraint, parse_trees</span>
    <span class="c1"># still needs to be a list</span>

    <span class="n">parse_trees</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">constraint_strs</span><span class="p">)):</span>
        <span class="n">constraint_str</span> <span class="o">=</span> <span class="n">constraint_strs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="n">deltas</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

        <span class="c1"># Create parse tree object</span>
        <span class="n">parse_tree</span> <span class="o">=</span> <span class="n">ParseTree</span><span class="p">(</span>
            <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span>
            <span class="n">regime</span><span class="o">=</span><span class="s1">&#39;supervised&#39;</span><span class="p">,</span>
            <span class="n">sub_regime</span><span class="o">=</span><span class="s1">&#39;regression&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

        <span class="c1"># Fill out tree</span>
        <span class="n">parse_tree</span><span class="o">.</span><span class="n">create_from_ast</span><span class="p">(</span><span class="n">constraint_str</span><span class="p">)</span>
        <span class="c1"># assign deltas for each base node</span>
        <span class="c1"># use equal weighting for each unique base node</span>
        <span class="n">parse_tree</span><span class="o">.</span><span class="n">assign_deltas</span><span class="p">(</span><span class="n">weight_method</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

        <span class="c1"># Assign bounds needed on the base nodes</span>
        <span class="n">parse_tree</span><span class="o">.</span><span class="n">assign_bounds_needed</span><span class="p">()</span>

        <span class="n">parse_trees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parse_tree</span><span class="p">)</span>

    <span class="c1"># Define the underlying machine learning model</span>
    <span class="n">model_class</span> <span class="o">=</span> <span class="n">LinearRegressionModel</span>

    <span class="c1"># Define the primary objective, the MSE</span>
    <span class="n">primary_objective</span> <span class="o">=</span> <span class="n">model_class</span><span class="p">()</span><span class="o">.</span><span class="n">sample_Mean_Squared_Error</span>

    <span class="c1"># Define initial solution function</span>
    <span class="n">initial_solution_fn</span><span class="o">=</span><span class="n">model_class</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span>

    <span class="c1"># Create a spec object, using a lot of hidden defaults</span>

    <span class="n">spec</span> <span class="o">=</span> <span class="n">SupervisedSpec</span><span class="p">(</span>
        <span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span>
        <span class="n">model_class</span><span class="o">=</span><span class="n">model_class</span><span class="p">,</span>
        <span class="n">frac_data_in_safety</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
        <span class="n">primary_objective</span><span class="o">=</span><span class="n">primary_objective</span><span class="p">,</span>
        <span class="n">initial_solution_fn</span><span class="o">=</span><span class="n">initial_solution_fn</span><span class="p">,</span>
        <span class="n">parse_trees</span><span class="o">=</span><span class="n">parse_trees</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Run seldonian algorithm</span>
    <span class="n">passed_safety</span><span class="p">,</span><span class="n">candidate_solution</span> <span class="o">=</span> <span class="n">seldonian_algorithm</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">passed_safety</span><span class="p">,</span><span class="n">candidate_solution</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to use the engine to enforce this constraint, we need to write this constraint function as a constraint string. The constraint string is:</p>
<p>We also need to supply a <a class="reference internal" href="glossary.html#term-Confidence-level"><span class="xref std std-term">confidence level</span></a>, <span class="math notranslate nohighlight">\({\delta}\)</span>, for this constraint. Let’s use a value of <span class="math notranslate nohighlight">\({\delta}=0.05\)</span>, so that the constraint is enforced with a probability of <span class="math notranslate nohighlight">\(1-{\delta}=0.95\)</span>.</p>
<p>what datasets and constraints we want to use. We will use the command line interface (CLI) in this example, specifically the supervised learning CLI.</p>
<p>Looking at the documentation for <a class="reference internal" href="_autosummary/interface.cli_supervised.html#module-interface.cli_supervised" title="interface.cli_supervised"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cli_supervised</span></code></a>, we can see the usage is:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python interface.py data_pth metadata_pth
<span class="go">[--include_sensitive_columns]</span>
<span class="go">[--include_intercept_term]</span>
<span class="go">[--save_dir]</span>
</pre></div>
</div>
</div></blockquote>
<p>The two required arguments are <code class="code docutils literal notranslate"><span class="pre">data_pth</span></code>, the path to the data file and <code class="code docutils literal notranslate"><span class="pre">metadata_pth</span></code>, the path to the metadata file. The data and metadata files for this example can be downloaded from the source code repository on <a class="reference external" href="https://github.com/seldonian-framework/Engine/tree/main/static/datasets/GPA">GitHub</a>. The other arguments are optional, but we will want to use</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Seldonian Engine</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simple-example">Simple example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="overview.html" title="previous chapter">Overview</a></li>
      <li>Next: <a href="api.html" title="next chapter">API</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, University of Massachusetts, Amherst.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/getting_started.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>